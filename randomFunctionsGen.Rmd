# Title

```{r}
require(knitr)
require(MASS)
require(data.table)
require(ggplot2)
```


## Definitions

_Gaussian process_ is a collection of random variables, any
finite number of which have a joint Gaussian distribution.

A Gaussian process is completely specified by its mean function and
co- variance function. We define mean function \(m(x)\) and the
covariance function \(k(x,x')\) of a real process \(f(x)\) as
_covariance_ and _mean_ function
\[m(x) = \mathcal{E}[f(x)],\]
\[ k(x,x') = \mathcal{E}[(f(x) − m(x))(f(x') − m(x'))],\]
and will write the Gaussian process as
\( f(x) \sim GP(m(x), k(x, x'))\).

## Squared exponential

\[ cov(f(x_p), f (x_q)) = k(x_p , x_q) =
    \exp\Big(−\frac{1}{2} |x_p − x_q |\Big)^2.\]

```{r}
x <- seq(-5,5,0.5)

sim.number <- 5


squared.exp <- function(x,y,l=1) {
  exp(-0.5* (norm(x-y, type="2")/l)^2)
}

Sigma <- function(x1, x2, l=1) {
  n1 <- length(x1)
  n2 <- length(x2)
  S <- matrix(rep(0, n1*n2), nrow=n1)
  for (i in 1:n1) {
    for (j in 1:n2) {
      S[i,j] <- squared.exp(x1[i],x2[j],l)
    }
  }
  S
}

S <- Sigma(x,x)
sims <- data.table(x=x)
gens <- mvrnorm(sim.number, rep(0, length(x)), S)
sims <- cbind(sims, t(gens))
ggplot(sims,aes(x)) + geom_line(aes(y=V1)) +
    geom_line(aes(y=V2)) +
        geom_line(aes(y=V3)) 
```

## Formula que jode a Maria

\[\overline{y}^* = K^*(\lambda^2\cdot I+K)^{-1}\cdot y \]

\[C = K^{**}-K^*\cdot(\lambda^2\cdotI+K)^{-1}\cdot(K^*)^t \]

```{r}
x <- c(-4,-3,-1,0,2)
y <- c(-2,0, 1, 2, -1)

input <- data.table(x=x, y=y)

x.star <- seq(-5,5,0.1)
K <- Sigma(x,x)
K.star2 <- Sigma(x.star, x.star)
K.star <- Sigma(x.star, x)


y.star.bar <- K.star %*% solve(K) %*% y
C <- K.star2 - K.star %*% solve(K) %*% t(K.star)
y.star.bar


d <- c()
for (i in 1:dim(C)[1]) { d <- c(d,C[i,i]) }

ggplot() + geom_point(aes(x,y), size=3, colour="red") +
    geom_line(aes(x.star, y.star.bar)) +
        geom_ribbon(aes(x.star, ymax=y.star.bar+2*sqrt(abs(d)),
                        ymin=y.star.bar-2*sqrt(abs(d))), alpha=0.5) 

heatmap(C)
norm(Sigma(y.star.bar, y.star.bar) - C)/norm(C)

y.sim=mvrnorm(1, y.star.bar, C)
sims <- data.table(x=x.star, y=y.sim)

ggplot(sims, aes(x)) + geom_line(aes(y=mvrnorm(1, y.star.bar, C)))+
    geom_line(aes(y=mvrnorm(1, y.star.bar, C))) +
        geom_point(data=input, aes(x,y), size=3, colour="red")


d <- c()
for (i in 1:dim(C)[1]) { d <- c(d,C[i,i]) }
d
```

## Large n

If $n$ is large, for example $n\geq 10000$, then to solve the equation
is not practical. Therefore is is usefull to develope approximate
solution.
